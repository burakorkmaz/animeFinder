import express from "express";
import bodyParser from "body-parser";
import axios from "axios";

const app = express();
const port = 3000;

app.use(express.static("public"));
app.use(bodyParser.urlencoded({extended:true}));

const animeIDs = [5114,40028,9253,11061,28977,38524,9969,820,15417,28851,35180,34096,918,4181,15335,32281,35247,2904,39486,32935,37491,37510,199,31758,36838,33050,33095,1,17074,19,24701,263,23273,34599,36862,40591,44,28891,164,1575,21939,40456,37521,245,457,38329,431,2921,5258,11665,2001,7311,34591,37779,37987,12355,33352,42203,1535,22135,28957,38000,7785,31757,37991,38474,10379,19647,28735,42897,11741,32983,33049,35760,36098,12365,44042,44087,4565,5300,21329,30276,35839,40776,4282,801,30654,40417,40748,170,3297,20583,35843,21,6114,7472,12431,37379,38040,32,578,30484,31933,205,11577,36999,37208,39587,33,32182,437,10165,16498,34612,36885,877,24687,31181,39547,40059,392,467,5028,25777,26055,33255,35851,36649,37965,5205,11981,21899,42984,5941,10162,14397,31646,37999,38450,38889,136,2246,2251,9989,22789,32366,35557,36538,37105,38826,572,777,9260,10030,22535,36275,39741,40682,5,11979,17389,38883,7655,9756,10408,13601,25781,37450,40052,12029,30709,31043,39535,5081,5341,6594,10937,12531,2559,3784,5040,5420,11917,13125,20651,25835,39808,40211,486,6945,10087,10863,24415,34240,37515,38691,137,338,1210,4081,9617,28701,28805,33486,34534,40730,44235,30,1698,30230,30346,33674,37095,39533,43299,45,57,329,513,523,1365,2418,2685,32937,37078,31988,43,139,185,264,759,6675,19363,28171,31240,40852,2402,3002,11843,16894,18115,37055,627,1033,1842,2966,5690,9735,23327,23847,34036,34798,39112,1142,25537,31812,32188,558,3091,9863,10271,36456,38481,6,512,3226,4224,5460,15227,22507,33051,42498,265,585,1889,6864,7674,10800,11977,16664,18195,18617,34537,35466,38731,40784,372,6811,22297,30503,35677,36371,36990,38249,138,9890,12115,19123,32282,32843,34636,36296,440,853,962,2236,19815,28223,28675,31715,32867,37989,38680,40080,1519,13759,35838,37171,37520,38088,40421,1453,1604,6746,10153,11597,12859,23623,34822,38234,44248,47,121,239,1827,3701,4107,4155,4477,32005,35857,37822,38003,39792,232,235,813,1735,6336,25681,39198,40815,18,721,1430,3371,3901,6467,6547,7791,11771,15323,30831,35608,37962,38993,42497,1364,1566,2581,3702,12189,28025,32902,35788,37514,40435,40542,4722,4938,8129,22145,34076,186,731,2025,2150,3016,16662,18689,20899,23283,23317,24277,24833,135,1559,3927,9130,12069,16918,18679,21557,31964,32122,35111,1367,2449,8425,17739,25313,27821,27833,29831,31051,35062,36946,38668,237,302,1974,2164,5681,16067,21419,30370,33161,33323,36370,39592,40907,1382,1506,2951,3167,3665,4918,5365,15059,16706,35110,35848,36949,39565,39570,72,851,1914,2167,2759,3783,10643,14513,14813,27663,31658,34626,37430,16,153,1257,1471,1943,2034,6211,7054,14719,16049,21469,38408,39551,40935,42496,889,1482,4901,7465,12477,16782,25013,37870,38422,39195,39783,535,589,781,1363,1486,4789,4921,7720,12031,14713,34440,38081,40397,81,227,268,339,846,1023,6421,9963,14807,23199,25879,30015,33206,37932,39468,1065,2448,2563,4772,5029,6045,9204,31149,31174,31251,40716,861,1530,2004,4053,4672,5682,9656,16001,20507,27831,223,401,4059,6171,8740,10049,17265,18179,21647,27989,31173,32615,34376,35790,37936,77,387,967,9996,14075,21855];


app.get("/", (req, res) => {
    res.render("index.ejs");
});

app.get("/contacts", (req, res) => {
    res.render("contact.ejs")
})

app.post("/submit", async (req, res) =>{
    try{
        var randomID = animeIDs[Math.floor(Math.random()* animeIDs.length)];
        const result = await axios.get(`https://api.jikan.moe/v4/anime/${randomID}`);
        let nameDefault = "";
        let nameJapanese = "";
        for (var i = 0; i < result.data.data.titles.length ; i++){
            if (result.data.data.titles[i].type == "Default"){
                nameDefault += result.data.data.titles[i].title;
                continue;
            }
            if(result.data.data.titles[i].type == "Japanese"){
                nameJapanese += result.data.data.titles[i].title;
                continue;
            }
        }
        res.render("index.ejs", {
            data : result.data.data,
            nameD :nameDefault,
            nameJ :nameJapanese,
        } );

        
    
    }catch(error){
        console.log(error.response.data);
        res.status(500);
    }

});

app.listen(port, () => {
    console.log(`Port is ${port}`);
})
